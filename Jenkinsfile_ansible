pipeline {
    agent any
    environment {
        githosturl = "github.com"
    }
    
    stages { 
        stage('clone') {
            steps {
                git credentialsId: 'git_creds', url: 'https://github.com/hrudayhh/jjcfw.git'
            }
        }
        stage('pre-requisites') {
            steps {
                sh '''
                    echo "requirements file"
                    if [ -e roles/requirements.yml ]; then 
                      echo "req file found"
                    else
                      echo "req file not found"
                    fi
                '''
            }
        }
        stage('check urls') {
            steps {
                script {
                    output = "${sh(returnStdout: true, script: 'ansible-galaxy install -r roles/requirements.yml -p .')}"
                    println "${output}"
                    def emptyRequirements = output =~ /ERROR! No requirements found in file roles\/requirements.yml/
                        def ifDependencyInstalled = output =~ /installed successfully/
                        def ifAlreadyInstalled = output =~ /already installed, skipping/
                        println "${emptyRequirements}"
                        if (emptyRequirements.find()) {
                            
                            echo "There is no requirements found or the requirements are already installed"
                        }
                        else if(ifDependencyInstalled.find()) {
                            echo "Dependency Installed successfully"
                        }
                        else if(ifAlreadyInstalled.find()) {
                            echo "Dependency Already Installed skipping"
                        }
                        else {
                            error("Something went wrong with the requirements.yml file please check the logs for more details")
                        }
                }
            }
        }
    }
}
