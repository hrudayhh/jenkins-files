pipeline {
    agent any
    stages { 
        stage('clone') {
            steps {
                git credentialsId: 'git_creds', url: 'https://github.com/hrudayhh/jjcfw.git'
            }
        }
        stage('check urls') {
            steps {
                sh '''            
                count_roles=$(grep "src" roles/requirements.yml | cut -d':' -f2,3 | awk '{$1=$1;print}' | wc -l)
                if [ "$count_roles" -eq 0 ]; then
                  echo "No roles defined in requirements.yml file"
                  exit 1
                elif [ "$count_roles" -gt 0 ]; then
                  echo "Roles are defined in requirements.yml file"
                  echo "Verfying URLs of roles"
                  for repo_url in $(grep "src" roles/requirements.yml | cut -d':' -f2,3 | awk '{$1=$1;print}')
                  do
                    git ls-remote ssh://$repo_url
                    if [ $? -ne 0 ]; then
                      echo "[ERROR] Git URL $repo_url not found"
                      exit 1
                    else
                      echo "Git URL $repo_url found"
                    fi
                   done
                fi
                '''
            }
        }
    }
}
